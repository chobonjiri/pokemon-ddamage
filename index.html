<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ポケモン実数値計算ツール</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/css/autoComplete.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <link rel="stylesheet" href="style/base.css" />
  <link rel="stylesheet" href="style/layout.css" />
  <link rel="stylesheet" href="style/components/buttons.css" />
  <link rel="stylesheet" href="style/components/forms.css" />
  <link rel="stylesheet" href="style/components/segmented-control.css" />
  <link rel="stylesheet" href="style/modules/panels.css" />
  <link rel="stylesheet" href="style/modules/damage-popup.css" />
  <link rel="stylesheet" href="style/menu.css" />
  <link rel="stylesheet" href="style/main.css" /> 
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
  <script>
    // Your inline JavaScript here (rank, nature, damage popup updates)
    // It's generally good practice to move this to a separate JS file as well
    // e.g., script/ui-interactions.js or script/calculator-ui.js
    function changeRank(type, change) {
        const rankSpanId = `${type}-rank-val`;
        const rankSpan = document.getElementById(rankSpanId);
        let currentRank = parseInt(rankSpan.textContent);

        currentRank += change;

        if (currentRank < -6) {
            currentRank = -6;
        } else if (currentRank > 6) {
            currentRank = 6;
        }

        rankSpan.textContent = currentRank;
    }

    document.addEventListener('DOMContentLoaded', () => {
        function setupNatureControl(controlId, hiddenInputId) {
            const control = document.getElementById(controlId);
            const hiddenInput = document.getElementById(hiddenInputId);

            if (control && hiddenInput) {
                control.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', () => {
                        control.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        hiddenInput.value = button.dataset.value;
                    });
                });
            }
        }

        setupNatureControl('attack-nature-control', 'attack-nature');
        setupNatureControl('defense-nature-control', 'defense-nature');

        document.getElementById('attack-nature-control').querySelector(`button[data-value="${document.getElementById('attack-nature').value}"]`)?.classList.add('active');
        document.getElementById('defense-nature-control').querySelector(`button[data-value="${document.getElementById('defense-nature').value}"]`)?.classList.add('active');

        const attackerButton1 = document.getElementById('attacker-button-1');
        const attackerButton2 = document.getElementById('attacker-button-2');
        const attackerButtons = [attackerButton1, attackerButton2];

        attackerButtons.forEach(button => {
            if (button) {
                button.addEventListener('click', () => {
                    if (button.classList.contains('selected')) {
                        button.classList.remove('selected');
                    } else {
                        attackerButtons.forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                    }
                });
            }
        });

        const toggleSwitch = document.getElementById('toggleSwitch');
        const speedControl = document.getElementById('speedControl');
        const controlButtons = speedControl.querySelectorAll('button');

        controlButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.disabled) {
                    return;
                }
                controlButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            });
        });

        toggleSwitch.addEventListener('change', () => {
            const isEnabled = toggleSwitch.checked;
            
            controlButtons.forEach(button => {
                button.disabled = !isEnabled;
            });

            if (isEnabled) {
                speedControl.classList.remove('disabled-state');
            } else {
                speedControl.classList.add('disabled-state');
                controlButtons.forEach(btn => btn.classList.remove('active'));
            }
        });
        
        toggleSwitch.dispatchEvent(new Event('change'));
    });

    function updateDamagePopup({ normalMin, normalMax, critical, damageNormalMin, damageNormalMax, damageCritical, targetHP }) {
      const normalMinPercent = (normalMin / targetHP) * 100;
      const normalMaxPercent = (normalMax / targetHP) * 100;
      const criticalPercent = (critical / targetHP) * 100;

      document.getElementById('normal-min').style.left = '0%';
      document.getElementById('normal-min').style.width = normalMinPercent + '%';

      document.getElementById('normal-max').style.left = normalMinPercent + '%';
      document.getElementById('normal-max').style.width = (normalMaxPercent - normalMinPercent) + '%';

      document.getElementById('critical').style.left = normalMaxPercent + '%';
      document.getElementById('critical').style.width = (criticalPercent - normalMaxPercent) + '%';

      document.getElementById('label-normal').textContent = `通常: ${Math.round(normalMinPercent)}% - ${Math.round(normalMaxPercent)}%`;
      document.getElementById('label-critical').textContent = `急所: ${Math.round(criticalPercent)}%`;
      document.getElementById('value-normal').textContent = `通常: ${damageNormalMin} - ${damageNormalMax} ダメージ`;
      document.getElementById('value-critical').textContent = `急所: ${damageCritical} ダメージ`;
    }

    updateDamagePopup({
      normalMin: 30,
      normalMax: 40,
      critical: 60,
      damageNormalMin: 30,
      damageNormalMax: 40,
      damageCritical: 60,
      targetHP: 100
    });
  </script>
  <script src="ui/app.js" defer></script>
</body>
</html>